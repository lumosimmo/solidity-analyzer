name: CI

on:
  push:
    branches: ["master"]
  pull_request:

jobs:
  fmt:
    uses: ./.github/workflows/rust-job.yml
    with:
      components: rustfmt
      command: cargo fmt --all --check
      free_disk: false
      use_sccache: false
      use_rust_cache: false

  clippy:
    uses: ./.github/workflows/rust-job.yml
    with:
      components: clippy
      command: cargo clippy --workspace --all-targets -- -D warnings

  test-debug:
    uses: ./.github/workflows/rust-job.yml
    with:
      command: cargo test --workspace

  test-release:
    uses: ./.github/workflows/rust-job.yml
    with:
      command: cargo test --release -p solidity-analyzer

  build-release:
    uses: ./.github/workflows/rust-job.yml
    with:
      command: cargo build --locked --release -p solidity-analyzer

  xtask-dist:
    uses: ./.github/workflows/rust-job.yml
    with:
      command: cargo run -p xtask -- dist
